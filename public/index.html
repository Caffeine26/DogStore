<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Portfolio project, dog API consumption." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
    <title>Dog Store</title>
    <style>
        .card-img-top {
            height: 200px;
            object-fit: cover;
        }
        .card-body {
            height: 130px;
           
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .card-title {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/">üêï</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="#AdoptaDogs">Adoption</a></li>
                <li class="nav-item"><a class="nav-link" href="#DogsAdopted">Adopted</a></li>
                <li class="nav-item"><a class="nav-link" href="#Sumit">Upload</a></li>
                <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
            </ul>
        </div>
    </nav>
    <!-- Banner -->
    <section id="Banner" class="jumbotron jumbotron-fluid">
        <div class="container text-center">
            <img src="https://images.unsplash.com/photo-1601758003122-53c40e686a19" alt="Couple on a bed with a dog" class="img-fluid">
            <h1 class="display-4">Adopting Dogs üê©</h1>
            <p class="lead">This website is created for adopting dogs and visiting our fun and lovely dogs.</p>
            <a class="btn btn-primary btn-lg" style="width:200px" href="#AdoptaDogs" role="button">Visit</a>
            <a class="btn btn-secondary btn-lg" style="width:200px" href="#DogsAdopted" role="button">Adopt</a>
        </div>
    </section>
    <!-- Dog Cards -->
    <section id="AdoptaDogs" class="container">
        <div class="alert alert-danger d-none" role="alert" id="Error"></div>
        <h2 class="text-center my-4">Dogs for Adoption</h2>
        <div class="text-center mb-4">
            <button class="btn btn-outline-primary" onclick="loadRandomDog()">üêï See more dogs üê©</button>
        </div>
        <div class="row">
            <div class="col-md-3 mb-4" id="btn1">
                <div class="card">
                    <img id="img1" class="card-img-top" alt="Dog for Adoption">
                    <div class="card-body text-center">
                        <h7 class="card-title">Click below for adopting</h7>
                        <a href="#" class="btn btn-primary">Adopt</a>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4" id="btn2">
                <div class="card">
                    <img id="img2" class="card-img-top" alt="Dog for Adoption">
                    <div class="card-body text-center">
                        <h7 class="card-title">Click below for adopting</h7>
                        <a href="#" class="btn btn-primary">Adopt</a>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4" id="btn3">
                <div class="card">
                    <img id="img3" class="card-img-top" alt="Dog for Adoption">
                    <div class="card-body text-center">
                        <h7 class="card-title">Click below for adopting</h7>
                        <a href="#" class="btn btn-primary">Adopt</a>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4" id="btn4">
                <div class="card">
                    <img id="img4" class="card-img-top" alt="Dog for Adoption">
                    <div class="card-body text-center">
                        <h7 class="card-title">Click below for adopting</h7>
                        <a href="#" class="btn btn-primary">Adopt</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Upload Dog Section -->
    <section id="Subir" class="jumbotron jumbotron">
        <h2 class="text-center">Upload Your Dog</h2>
        <form id="uploadingForm">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="name" name="name">
                </div>
                <div class="form-group col-md-6">
                    <label for="age">Age</label>
                    <input type="text" class="form-control" id="age" name="age">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="breed">Breed</label>
                    <input type="text" class="form-control" id="breed" name="breed">
                </div>
                <div class="form-group col-md-6">
                    <label for="file">Photo</label>
                    <input type="file" class="form-control-file" id="file" name="file">
                    <div id="preview" class="mt-3"></div>
                </div>
            </div>
            <button type="button" class="btn btn-primary" onclick="uploadDogPhoto()">Upload Dog</button>
        </form>
    </section>
    
    <!-- Adopted Dogs Section -->
    <section id="DogsAdopted" class="container my-4">
        <h2 class="text-center">Adopted Dogs</h2>
        <div class="row" id="favoritesDogs"></div>
    </section>
    <!-- Contact us Section -->
    <section id="contact" class="jumbotron jumbotron ">
       
        <div class="jumbotron jumbotron-fluid  ">
          <h1  style="padding-left: 10px;">Contact us</h1>
                    <div class="jumbotron jumbotron-fluid" style="margin:10px">
                        <form>
                            <div class="form-group">
                                <label for="contactEmail">Email address</label>
                                <input type="email" class="form-control" id="contactEmail" placeholder="Enter your email">
                            </div>
                            <div class="form-group">
                                <label for="contactMessage">Message</label>
                                <textarea class="form-control" id="contactMessage" rows="4" placeholder="Your message"></textarea>
                            </div>
                            <button  style=" margin-bottom: 15px;"type="submit" class="btn btn-primary" >Send Message</button>
                         </form>

                        <div class="card-footer text-muted text-center">
                            <p>Email: <a href="mailto:sorsonit06@gmail.com">sorsonit06@gmail.com</a></p>
                            <p>Facebook: <a href="https://web.facebook.com/profile.php?id=100091639720902" target="_blank">sonit sor</a></p>
                            <p>Phone: +855 977429389</p>
                        </div>
                    
                   
            
            
     
    </section>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const API_URL_RANDOM = "https://api.thedogapi.com/v1/images/search?limit=4";
        const API_URL_FAVORITE = "https://api.thedogapi.com/v1/favourites";
        const API_URL_FAVORITE_DELETE = (id) => `https://api.thedogapi.com/v1/favourites/${id}?api_key=`;
        const API_URL_UPLOAD = "https://api.thedogapi.com/v1/images/upload";
        const spanError = document.getElementById("Error");

        async function loadRandomDog() {
            const response = await fetch(API_URL_RANDOM);
            const data = await response.json();
            console.log("Load Random Dog");
            console.log(data);
            if (response.status !== 200) {
                spanError.innerHTML = "Error: " + response.status + " " + data.message;
            } else {
                document.getElementById("img1").src = data[0].url;
                document.getElementById("img2").src = data[1].url;
                document.getElementById("img3").src = data[2].url;
                document.getElementById("img4").src = data[3].url;
                document.getElementById("btn1").onclick = () => saveFavoriteDog(data[0].id);
                document.getElementById("btn2").onclick = () => saveFavoriteDog(data[1].id);
                document.getElementById("btn3").onclick = () => saveFavoriteDog(data[2].id);
                document.getElementById("btn4").onclick = () => saveFavoriteDog(data[3].id);
            }
        }

        async function loadFavoriteDog() {
            const response = await fetch(API_URL_FAVORITE, {
                method: "GET",
                headers: {
                    'X-API-KEY': 'ae4e08e8-4f4c-4f0b-8159-98b33b9d46f2',
                },
            });
            const data = await response.json();
            console.log("Load Favorite Dog");
            console.log(data);
            if (response.status !== 200) {
                spanError.innerHTML = "Error: " + response.status + " " + data.message;
            } else {
                const article = document.getElementById("favoritesDogs");
                article.innerHTML = "";
                data.forEach(dog => {
                    const div = document.createElement("div");
                    div.classList.add("col-md-3", "mb-4");
                    const card = document.createElement("div");
                    card.classList.add("card");
                    const img = document.createElement("img");
                    img.classList.add("card-img-top");
                    img.src = dog.image.url;
                    const cardBody = document.createElement("div");
                    cardBody.classList.add("card-body", "text-center");
                    const h5 = document.createElement("h5");
                    h5.classList.add("card-title");
                    h5.innerText = "Adopted";
                    const a = document.createElement("a");
                    a.classList.add("btn", "btn-success");
                    a.href = "#";
                    a.innerText = "Remove";
                    a.onclick = () => deleteFavoriteDog(dog.id);
                    cardBody.appendChild(h5);
                    cardBody.appendChild(a);
                    card.appendChild(img);
                    card.appendChild(cardBody);
                    div.appendChild(card);
                    article.appendChild(div);
                });
            }
        }

        async function saveFavoriteDog(id) {
            const response = await fetch(API_URL_FAVORITE, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    'X-API-KEY': 'ae4e08e8-4f4c-4f0b-8159-98b33b9d46f2',
                },
                body: JSON.stringify({
                    image_id: id,
                }),
            });
            const data = await response.json();
            console.log("Save Favorite Dog");
            console.log(data);
            if (response.status !== 200) {
                spanError.innerHTML = "Error: " + response.status + " " + data.message;
            } else {
                console.log("Saved");
                loadFavoriteDog();
            }
        }

        async function deleteFavoriteDog(id) {
            const response = await fetch(API_URL_FAVORITE_DELETE(id), {
                method: "DELETE",
                headers: {
                    'X-API-KEY': 'ae4e08e8-4f4c-4f0b-8159-98b33b9d46f2',
                },
            });
            const data = await response.json();
            if (response.status !== 200) {
                spanError.innerHTML = "Error: " + response.status + " " + data.message;
            } else {
                console.log("Deleted");
                loadFavoriteDog();
            }
        }

        async function uploadDogPhoto() {
            const form = document.getElementById("uploadingForm");
            const formData = new FormData(form);
            console.log(formData.get("file"));
            const response = await fetch(API_URL_UPLOAD, {
                method: "POST",
                headers: {
                    'X-API-KEY': 'ae4e08e8-4f4c-4f0b-8159-98b33b9d46f2',
                },
                body: formData,
            });
            const data = await response.json();
            if (response.status !== 201) {
                spanError.innerHTML = "Error: " + response.status + " " + data.message;
                console.log('Error');
                console.log({ data });
            } else {
                console.log('Dog photo uploaded');
                console.log({ data });
                console.log(data.url);
                saveFavoriteDog(data.id);
                console.log('End of function');
            }
        }

        document.getElementById("file").onchange = function (e) {
            let reader = new FileReader();
            reader.readAsDataURL(e.target.files[0]);
            reader.onload = function () {
                let preview = document.getElementById("preview"),
                    image = document.createElement("img");
                image.classList.add("w-20", "h-20", "rounded-full", "shadow-sm");
                image.src = reader.result;
                preview.innerHTML = "";
                preview.append(image);
            };
        };

        loadRandomDog();
        loadFavoriteDog();
    </script>
</body>
</html>
